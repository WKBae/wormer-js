<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<title></title>

		<!-- Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

		<link rel="stylesheet" href="css/dygraph.min.css">

		<style>
			.render {
				padding: 5px;
				border-radius: 3px;
				border: 1px solid #CCC;
				overflow: hidden;
			}
			.dygraph-legend {
				background: rgba(240, 240, 240, 0.5);
				padding: 5px;
				width: auto;
				border-radius: 3px;
			}
			.simulation-ops {
				margin-bottom: 1em;
			}
			.options-wrapper {
				margin-top: 1em;
			}
			.options-wrapper h4 {
				margin-top: 0;
			}
		</style>
	</head>
	<body>
		<div class="container-fluid" id="options">
			<div class="row">
				<div class="col-xs-12">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">설정</h3>
						</div>
						<div class="panel-body">
							<form>
								<div class="panel panel-default">
									<div class="panel-heading">
										<h3 class="panel-title">시뮬레이션 설정</h3>
									</div>
									<div class="panel-body row simulation">
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="worms-per-gen">세대당 개체 수</label>
											<input type="number" class="form-control" min="1" id="worms-per-gen" value="20">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="preserved-worms">유지되는 상위 개체 수</label>
											<input type="number" class="form-control" min="0" id="preserved-worms" value="3">
										</div>
										<!--div class="form-group col-md-3 col-sm-6 col-xs-12"-->
											<input type="hidden" id="timestep" value="60">
										<!--/div-->
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="speed">시뮬레이션 속도</label>
											<div class="input-group">
												<input type="range" class="form-control" min="0" max="1" step="0.1" id="speed" value="0" size="10" oninput="speedOut.value=speed.value">
												<output class="input-group-addon" id="speedOut">0</output>
											</div>
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="duration">한 세대가 끝날 때까지의 시간</label>
											<input type="number" class="form-control" min="0" id="duration" value="15000">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="end">종료할 세대</label>
											<input type="number" class="form-control" min="1" id="end" value="50">
										</div>
									</div>
								</div>
								<div class="panel panel-default">
									<div class="panel-heading">
										<h3 class="panel-title">개체 설정</h3>
									</div>
									<div class="panel-body row worm">
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="width">폭</label>
											<input type="number" class="form-control" min="0.1" step="0.1" id="width" value="10">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="length">길이</label>
											<input type="number" class="form-control" min="0.1" step="0.1" id="length" value="100">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="joints">관절 수</label>
											<input type="number" class="form-control" min="1" id="joints" value="8">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="stiffness">유연성</label>
											<div class="input-group">
												<input type="range" class="form-control" min="0" max="1" step="0.05" id="stiffness" value="0.4" oninput="stiffnessOut.value=stiffness.value">
												<output class="input-group-addon" id="stiffnessOut">0.4</output>
											</div>
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="friction">마찰력</label>
											<div class="input-group">
												<input type="range" class="form-control" min="0" max="1" step="0.05" id="friction" value="0.1" oninput="frictionOut.value=friction.value">
												<output class="input-group-addon" id="frictionOut">0.1</output>
											</div>
										</div>
									</div>
								</div>
								<div class="panel panel-default">
									<div class="panel-heading">
										<div class="panel-title">유전자 설정</div>
									</div>
									<div class="panel-body row gene">
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="phases">유전자의 갯수</label>
											<input type="number" class="form-control" min="1" id="phases" value="128">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="period">한 유전자가 유지되는 시간</label>
											<input type="number" class="form-control" min="1" id="period" value="5">
										</div>
										<div class="form-group col-md-3 col-sm-6 col-xs-12">
											<label for="mutation">돌연변이 확률</label>
											<div class="input-group">
												<input type="range" class="form-control" min="0" max="1" step="0.01" id="mutation" value="0.01" oninput="mutationOut.value=mutation.value">
												<output class="input-group-addon" id="mutationOut">0.01</output>
											</div>
										</div>
									</div>
								</div>
								<div class="form-group">
									<input type="checkbox" id="doRender" checked><label for="doRender"> 화면 그리기</label>
								</div>
								<input type="submit" class="btn btn-primary" id="start" value="시작"> <input type="reset" value="초기화" class="btn btn-default">
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="container-fluid" id="simulation" style="display:none">
			<div class="row">
				<div class="col-xs-12">
					<div class="panel panel-danger" id="simulation-panel">
						<div class="panel-heading">
							<h3 class="panel-title">
								<span class="info-state">Terminated</span>: Generation <span class="info-current-gen"></span>
							</h3>
						</div>
						<div class="panel-body">
							<div class="btn-group simulation-ops">
								<button class="btn btn-success" id="simulation-start">
									<span class="glyphicon glyphicon-play" aria-hidden="true"></span> Start
								</button>
								<button class="btn btn-info" id="simulation-pause">
									<span class="glyphicon glyphicon-pause" aria-hidden="true"></span> Pause
								</button>
								<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">
									<span class="caret"></span>
								</button>

								<ul class="dropdown-menu">
									<li><a data-target="#" role="button" id="export-simulation">
										<span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Save simulation
									</a></li>
									<li class="divider" role="separator"></li>
									<li><a data-target="#" role="button" id="export-options">
										<span class="glyphicon glyphicon-cog" aria-hidden="true"></span> Save simulation options
									</a></li>
									<li><a data-target="#" role="button" id="export-statics">
										<span class="glyphicon glyphicon-stats" aria-hidden="true"></span> Save fitness statics
									</a></li>
									<li class="divider" role="separator"></li>
									<li><a role="button" data-toggle="modal" data-target="#modal-termination">
										<span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span> Terminate
									</a></li>
								</ul>
							</div>

							<ul class="nav nav-tabs">
								<li class="active"><a href="#tab-status" data-toggle="tab">Status</a></li>
								<li><a href="#tab-history" data-toggle="tab">History</a></li>
							</ul>

							<div class="tab-content">
								<div class="tab-pane active" id="tab-status">
									<div class="options-wrapper panel panel-default">
										<div class="panel-heading">
											<h3 class="panel-title">Project Setting</h3>
										</div>
										<div class="panel-body"><div class="row">
											<div class="col-md-4 col-sm-6 col-xs-12">
												<h4>Simulation options</h4>
												<dl class="dl-horizontal">
													<dt>Worms per gen</dt>
													<dd class="info-option-simulation-wormsPerGeneration"></dd>
													<dt>Preserved worms</dt>
													<dd class="info-option-simulation-preservedWorms"></dd>
													<dt>Simulation speed</dt>
													<dd class="info-option-simulation-speedFactor"></dd>
													<dt>Generation duration</dt>
													<dd class="info-option-simulation-duration"></dd>
												</dl>
											</div>
											<div class="col-md-4 col-sm-6 col-xs-12">
												<h4>Worm options</h4>
												<dl class="dl-horizontal">
													<dt>Width</dt>
													<dd class="info-option-worm-width"></dd>
													<dt>Length</dt>
													<dd class="info-option-worm-length"></dd>
													<dt>Joints</dt>
													<dd class="info-option-worm-joints"></dd>
													<dt>Joint stiffness</dt>
													<dd class="info-option-worm-stiffness"></dd>
													<dt>Friction</dt>
													<dd class="info-option-worm-friction"></dd>
												</dl>
											</div>
											<div class="col-md-4 col-sm-6 col-xs-12">
												<h4>Gene options</h4>
												<dl class="dl-horizontal">
													<dt>Phases</dt>
													<dd class="info-option-gene-phases"></dd>
													<dt>Operation period</dt>
													<dd class="info-option-gene-period"></dd>
													<dt>Mutation probability</dt>
													<dd class="info-option-gene-mutation"></dd>
												</dl>
											</div>
										</div></div>
									</div>

									<div class="page-header">
										<h3>Current State <small class="info-state"></small></h3>
									</div>
									<div class="row">
										<div class="col-xs-12">
											<dl class="dl-horizontal">
												<dt>Time spent</dt>
												<dd class="info-time-total"></dd>
												<dt>Time in simulation</dt>
												<dd class="info-time-simulation"></dd>
												<dt>Generations passed</dt>
												<dd class="info-generation"></dd>
												<dt>Best fitness</dt>
												<dd class="info-fitness-max"></dd>
											</dl>
										</div>
									</div>

									<div class="page-header">
										<h3>Running simulations</h3>
									</div>
									<div class="row" id="renders"></div>
								</div>
								<div class="tab-pane" id="tab-history">
									<div class="row">
										<div class="col-sm-6 col-xs-12">
											<div id="historyChart" style="width:100%"></div>
										</div>
										<div class="col-sm-6 col-xs-12">
											<div class="page-header">
												<h3>Previous generation</h3>
											</div>
											<dl class="dl-horizontal">
												<dt>Maximum fitness</dt>
												<dd class="info-fitness-max"></dd>
												<dt>Average fitness</dt>
												<dd class="info-fitness-avg"></dd>
												<dt>Median fitness</dt>
												<dd class="info-fitness-mid"></dd>
												<dt>Standard deviation</dt>
												<dd class="info-fitness-stdev"></dd>
											</dl>
										</div>
										<div class="col-xs-12" id="rerun" style="display:none">
											<div class="page-header">
												<h3>Simulation</h3>
											</div>
											<div id="rerun-render"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" tabindex="-1" role="dialog" id="modal-termination">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title"><span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Warning!</h4>
					</div>
					<div class="modal-body">
						<p>You are trying to terminate the simulation session. When terminated, the <b class="text-uppercase">whole</b> progress will be lost if you start a simulation again.</p>
						<p>The simulation should be saved to prevent data loss. Are you sure to continue?</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-danger" id="simulation-terminate" data-dismiss="modal">Terminate now</button>
					</div>
				</div>
			</div>
		</div>

		<script src="js/jquery-3.1.1.min.js"></script>
		<script src="js/matter.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/dygraph.min.js"></script>
		<script src="js/wormer.js"></script>
	</body>
</html>
